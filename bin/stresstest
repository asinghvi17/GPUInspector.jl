#!/bin/sh
#=
if [ $# -eq 0 ] || [ $# -eq 1 ]
then
    echo "No arguments supplied"
    echo "Usage: ./stresstest <NoOfThreads> <timeInMinutes>"
    exit
fi
exec julia -t $1 --project=$(dirname $0)/../ -O3 "$0" -- $@
=#
import Pkg

bin_path = @__DIR__
gpuinspector_path = join(split(bin_path, "/")[1:end-1],"/")

Pkg.activate(@__DIR__)

Pkg.instantiate()
Pkg.add("CairoMakie")
Pkg.add(path=gpuinspector_path)

using GPUInspector
using CairoMakie

function main()
  duration = parse(Int64,ARGS[2]) * 60
  results = stresstest(devices(); duration=duration, monitoring=true) 

  save_monitoring_results("data.hdf5",results)
  plot_monitoring_results(results)
  savefig_monitoring_results(results)
end


main()
