# Example: GPU Stress Test

!!! note
    **Test system:** DGX with 8x A100 GPUs

## Single GPU

```julia
julia> stresstest(device(); duration=10)
[ Info: Will try to run for approximately 10 seconds on each GPU.
[ Info: Running StressTest{Float32} on Julia thread 2 and CuDevice(0).
[ Info: Ran 11241 iterations on CuDevice(0).
[ Info: Clearing GPU memory.
[ Info: Took 10.0 seconds to run the tests.
```

## Multiple GPUs

First, make sure to run Julia with enough threads (more or equal to the number of GPU devices). Then, to run a GPU Stress test, use [`stresstest`](@ref).

In the following example, I started Julia with `julia -t 20` (why not? ­Ъўё).

```julia
julia> using GPUInspector

julia> stresstest(CUDA.devices(); duration=10)
[ Info: Will try to run for approximately 10 seconds on each GPU.
[ Info: Running StressTest{Float32} on Julia thread 2 and CuDevice(0).
[ Info: Running StressTest{Float32} on Julia thread 8 and CuDevice(6).
[ Info: Running StressTest{Float32} on Julia thread 4 and CuDevice(2).
[ Info: Running StressTest{Float32} on Julia thread 7 and CuDevice(5).
[ Info: Running StressTest{Float32} on Julia thread 5 and CuDevice(3).
[ Info: Running StressTest{Float32} on Julia thread 9 and CuDevice(7).
[ Info: Running StressTest{Float32} on Julia thread 6 and CuDevice(4).
[ Info: Running StressTest{Float32} on Julia thread 3 and CuDevice(1).
[ Info: Ran 11222 iterations on CuDevice(3).
[ Info: Ran 11203 iterations on CuDevice(6).
[ Info: Ran 11227 iterations on CuDevice(2).
[ Info: Ran 11230 iterations on CuDevice(4).
[ Info: Ran 11231 iterations on CuDevice(1).
[ Info: Ran 11199 iterations on CuDevice(0).
[ Info: Ran 11215 iterations on CuDevice(5).
[ Info: Ran 11246 iterations on CuDevice(7).
[ Info: Clearing GPU memory.
[ Info: Took 10.0 seconds to run the tests.
```

## Monitoring

To verify that the GPUs are actually busy you could use external tools like, e.g., `nvidia-smi`. However, we also provide built-in monitoring tools.

```julia
julia> using GPUInspector                                                       
                                                                                    
julia> monitoring_start()                                                           
[ Info: Spawning monitoring on Julia thread 20.

julia> stresstest(devices(); duration=10) # all devices, 10 seconds
[ Info: Will try to run for approximately 10 seconds on each GPU.
[ Info: Running StressTest{Float32} on Julia thread 4 and CuDevice(2).
[ Info: Running StressTest{Float32} on Julia thread 2 and CuDevice(0).
[ Info: Running StressTest{Float32} on Julia thread 6 and CuDevice(4).
[ Info: Running StressTest{Float32} on Julia thread 3 and CuDevice(1).
[ Info: Running StressTest{Float32} on Julia thread 9 and CuDevice(7).
[ Info: Running StressTest{Float32} on Julia thread 7 and CuDevice(5).
[ Info: Running StressTest{Float32} on Julia thread 5 and CuDevice(3).
[ Info: Running StressTest{Float32} on Julia thread 8 and CuDevice(6).
[ Info: Ran 11215 iterations on CuDevice(2).
[ Info: Ran 11241 iterations on CuDevice(6).
[ Info: Ran 11261 iterations on CuDevice(1).
[ Info: Ran 11236 iterations on CuDevice(5).
[ Info: Ran 11263 iterations on CuDevice(4).
[ Info: Ran 11261 iterations on CuDevice(3).
[ Info: Ran 11270 iterations on CuDevice(7).
[ Info: Ran 11241 iterations on CuDevice(0).
[ Info: Clearing GPU memory.
[ Info: Took 10.0 seconds to run the tests.

julia> results = monitoring_stop();
[ Info: Stopping monitoring and fetching results...
```

Here, `results` is a named tuple with time series information about GPU utilization, temperature, and more. See [`monitoring_stop`](@ref) for details.

You can use [`save_monitoring_results`](@ref) to save the results on disk. We also provide [`plot_monitoring_results`](@ref) to visualize the results, which should give you an output like this.

```
julia> plot_monitoring_results(results)

             РађРађРађРађРађРађРађРађРађGPU Utilization (Compute)
             РћїРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћљ        
         105 РћѓРађРађРађРађРАцРацРацРацРацРацРацРацРацРацРацРацРацРацРацРацРацРацРацРацРбцРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ GPU 0: NVIDIA A100-SXM4-40GB
             РћѓРађРађРађРб░РаЂРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРаѕРАєРађРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ GPU 1: NVIDIA A100-SXM4-40GB
             РћѓРађРађРађРбИРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ GPU 2: NVIDIA A100-SXM4-40GB
             РћѓРађРађРађРбИРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ GPU 3: NVIDIA A100-SXM4-40GB
             РћѓРађРађРађРАИРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ GPU 4: NVIDIA A100-SXM4-40GB
             РћѓРађРађРађРАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбИРађРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ GPU 5: NVIDIA A100-SXM4-40GB
             РћѓРађРађРађРАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбИРађРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ GPU 6: NVIDIA A100-SXM4-40GB
   U [%]     РћѓРађРађРађРАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбИРађРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ GPU 7: NVIDIA A100-SXM4-40GB
             РћѓРађРађРб░РаЂРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРаѕРАєРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ                             
             РћѓРађРађРбИРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ                             
             РћѓРађРађРбИРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ                             
             РћѓРађРађРАИРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбЄРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ                             
             РћѓРађРађРАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбИРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ                             
             РћѓРађРађРАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбИРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ                             
           0 РћѓРБђРБђРАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбИРБђРБђРађРађРађРађРађРађРађРађРађРађРађРћѓ                             
             РћћРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћў                             
             Рађ0РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ20Рађ                             
             РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађTime [s]РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ                                                          
                                                                                                                 
            РађРађРађРађРађРађРађРађРађРађРађРађРађРађGPU TemperatureРађРађРађРађРађРађРађРађРађРађРађРађРађ                             
            РћїРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћљ                             
         63 РћѓРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ GPU 0: NVIDIA A100-SXM4-40GB
            РћѓРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбђРАаРацРацРацРањРбњРБ▓РАђРађРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ GPU 1: NVIDIA A100-SXM4-40GB
            РћѓРађРађРађРађРађРађРађРађРађРађРађРађРбђРАаРацРањРаіРБЂРацРБцРацРаХРа«РаЏРаЏРАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ GPU 2: NVIDIA A100-SXM4-40GB
            РћѓРађРађРађРађРађРађРађРАаРБњРБЅРБЅРБГРБЊРаГРаЏРаІРаЅРаЅРаЅРађРађРађРађРађРађРб╗РађРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ GPU 3: NVIDIA A100-SXM4-40GB 
            РћѓРађРађРађРађРађРбаРБ«Ра«РаіРаЂРађРађРађРађРађРађРађРађРађРађРађРбђРАаРбцРБцРаИРАёРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ GPU 4: NVIDIA A100-SXM4-40GB 
            РћѓРађРађРађРађРбаРА┐РаЂРађРађРађРађРађРбђРАаРацРБцРацРаХРа«РаЏРаІРБЅРаГРаЦРацРАЄРАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ GPU 5: NVIDIA A100-SXM4-40GB 
            РћѓРађРађРађРбаРБиРаЂРађРБаРБњРаХРањРбЅРБЅРбГРБЏРБњРБњРАфРаЮРаЏРаЏРаіРаЅРаЅРаЅРБ┐РбИРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ GPU 6: NVIDIA A100-SXM4-40GB 
   T [C]    РћѓРађРађРађРБ╝РаЃРбаРаіРБЂРацРаћРаџРаЊРаіРаЂРађРађРађРађРађРађРађРађРађРађРађРб╗РАъРа▓РАцРађРађРађРађРађРађРађРађРађРађРађРћѓ GPU 7: NVIDIA A100-SXM4-40GB 
            РћѓРађРађРбаРАЈРбаРБ┐РаІРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРаИРБДРађРаѕРађРађРађРађРађРађРађРађРађРађРађРћѓ                              
            РћѓРађРађРБ╝РбАРБиРаЃРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРб┐РађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ                              
            РћѓРацРацРАЪРБИРАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРаИРА│РАбРађРађРађРађРађРађРађРађРађРађРађРћѓ                              
            РћѓРаЅРаЏРбЄРАЪРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРаѕРафРађРађРађРађРађРађРађРађРађРађРађРћѓ                              
            РћѓРађРађРБИРаЂРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ                              
            РћѓРањРањРАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ                              
         28 РћѓРаЅРаЅРаЂРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ                              
            РћћРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћў                              
            Рађ0РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ20Рађ                              
            РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађTime [s]РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ                              
                                                                                                                 
             РађРађРађРађРађРађРађРађРађРађРађРађРађРађGPU Power UsageРађРађРађРађРађРађРађРађРађРађРађРађРађ                              
             РћїРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћљ                             
         340 РћѓРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбђРБђРБђРБђРБђРБђРБђРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ GPU 0: NVIDIA A100-SXM4-40GB
             РћѓРађРађРађРађРБцРБаРБцРБцРБХРАХРаХРаХРаХРаЙРа┐Ра┐РБХРБ┐РБиРБХРБХРБХРБњРБњРБ║РАёРађРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ GPU 1: NVIDIA A100-SXM4-40GB
             РћѓРађРађРађРб░РА»РАГРА┐РаЪРаЏРаЏРаЏРаЏРаЏРаЏРаЅРаЅРаЅРаЅРаЅРаЅРаЅРаЅРаЅРаЅРа╣РАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ GPU 2: NVIDIA A100-SXM4-40GB
             РћѓРађРађРађРбИРаІРАюРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ GPU 3: NVIDIA A100-SXM4-40GB
             РћѓРађРађРађРбИРА░РаЂРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРБДРађРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ GPU 4: NVIDIA A100-SXM4-40GB
             РћѓРађРађРађРБЙРаЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРб╗РађРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ GPU 5: NVIDIA A100-SXM4-40GB
             РћѓРађРађРађРБ┐РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбИРађРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ GPU 6: NVIDIA A100-SXM4-40GB
   P [W]     РћѓРађРађРађРБ┐РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбИРАёРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ GPU 7: NVIDIA A100-SXM4-40GB
             РћѓРађРађРбаРАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРаѕРАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ                              
             РћѓРађРађРбИРАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ                              
             РћѓРађРађРбИРаЂРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРБДРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ                              
             РћѓРађРађРБ╝РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРб╣РађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ                              
             РћѓРађРађРАЪРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбИРађРађРађРађРађРађРађРађРађРађРађРађРађРћѓ                              
             РћѓРађРађРАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбИРБХРБХРађРађРађРађРађРађРађРађРађРађРађРћѓ                              
          56 РћѓРБХРБХРАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРаѕРаЎРађРађРађРађРађРађРађРађРађРађРађРћѓ                              
             РћћРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћў                              
             Рађ0РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ20Рађ                              
             РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађTime [s]РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ                              
```